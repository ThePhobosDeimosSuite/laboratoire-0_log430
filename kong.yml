_format_version: "3.0"
_transform: true

services:
  # - name: product-service
  #   host: product-service
  #   routes:
  #     - name: product-route
  #       paths:
  #         - /api/product
  #       strip_path: false

  # - name: sales-service
  #   url: http://sales-service:3000
  #   routes:
  #     - name: sales-route
  #       paths:
  #         - ~/api/store/[0-9]+/sales.*$
  #       strip_path: false

  - name: stocks-service
    url: http://stocks-service:3000
    routes:
      - name: stocks-route
        paths:
          - ~/api/store/[0-9]+/stock.*$
          - ~/api/store/[0-9]+/order.*$
        strip_path: false

  # - name: account-service
  #   url: http://account-service:3000
  #   routes:
  #     - name: account-route
  #       paths:
  #         - /api/account
  #       strip_path: false

  # - name: online-sales-orchestrator
  #   url: http://online-sales-orchestrator:3000
  #   routes:
  #     - name: online-sales-orchestrator-route
  #       paths:
  #         - ~/api/store/[0-9]+/client/[0-9]+/cart.*$
  #       strip_path: false

  - name: event-store-service
    url: http://event-store-service:3000
    routes:
      - name: event-store-route
        paths:
          - ~/api/package/[0-9]+/state*$
        strip_path: false

  - name: package-service
    url: http://package-service:3000
    routes:
      - name: package-service-route
        paths:
          - ~/api/package/[0-9]+$
          - /api/package
        strip_path: false

        
# upstreams:
#   - name: product-service
#     algorithm: round-robin
#     targets:
#       - target: product-service:3000
#         weight: 100
      # - target: product-service2:3000
      #   weight: 100

plugins:
  - name: prometheus          
    enabled: true
    protocols: [http, https]
  - name: basic-auth
  - name: cors
    config:
      origins: 
        - "*"
      methods:
       - GET
       - POST
       - PUT
  
consumers:
  - username: my-user
    basicauth_credentials:
      - username: admin
        password: "123"